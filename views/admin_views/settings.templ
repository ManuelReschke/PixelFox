package admin_views

import (
	"fmt"
	"github.com/ManuelReschke/PixelFox/app/models"
)

templ settingsContent(settings models.AppSettings, csrfToken string) {
	<div class="max-w-4xl mx-auto">
		<div class="flex items-center justify-between mb-6">
			<h1 class="text-3xl font-bold">Systemeinstellungen</h1>
		</div>

		<div class="bg-base-100 rounded-lg shadow-md p-6">
			<form 
				hx-post="/admin/settings"
				hx-target="body"
				hx-push-url="true"
				method="POST" 
				action="/admin/settings" 
				class="space-y-6"
			>
				<input type="hidden" name="_csrf" value={ csrfToken }/>

				<!-- Site Title -->
				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">Seitentitel</span>
					</label>
					<input 
						type="text" 
						name="site_title" 
						value={ settings.SiteTitle }
						class="input input-bordered w-full" 
						placeholder="Seitentitel eingeben"
						required
					/>
					<label class="label">
						<span class="label-text-alt">Dieser Titel wird in der Navigation und im Browser-Titel angezeigt.</span>
					</label>
				</div>

				<!-- Site Description -->
				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">Seitenbeschreibung</span>
					</label>
					<textarea 
						name="site_description" 
						class="textarea textarea-bordered h-24" 
						placeholder="Seitenbeschreibung eingeben"
					>{ settings.SiteDescription }</textarea>
					<label class="label">
						<span class="label-text-alt">Diese Beschreibung wird für Meta-Tags und SEO verwendet.</span>
					</label>
				</div>

				<!-- Image Upload Settings -->
				<div class="divider">Bild-Upload Einstellungen</div>
				
				<div class="form-control">
					<label class="label cursor-pointer">
						<span class="label-text font-semibold">Bild-Upload aktivieren</span>
						<input 
							type="checkbox" 
							name="image_upload_enabled" 
							class="checkbox"
							if settings.ImageUploadEnabled {
								checked
							}
						/>
					</label>
					<label class="label">
						<span class="label-text-alt">Wenn deaktiviert, können Benutzer keine neuen Bilder hochladen.</span>
					</label>
				</div>

				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">Job Queue Worker Anzahl</span>
					</label>
					<input 
						type="number" 
						name="job_queue_worker_count" 
						value={ fmt.Sprintf("%d", settings.JobQueueWorkerCount) }
						class="input input-bordered w-full" 
						placeholder="5"
						min="1"
						max="20"
						required
					/>
					<label class="label">
						<span class="label-text-alt">Anzahl der gleichzeitigen Background-Prozesse (1-20). Bei 5 Workern werden 5 Jobs parallel abgearbeitet - nicht nacheinander</span>
					</label>
				</div>

				<!-- S3 Backup Settings -->
				<div class="divider">S3 Backup Einstellungen</div>
				
				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">S3 Backup Verzögerung (Minuten)</span>
					</label>
					<input 
						type="number" 
						name="s3_backup_delay_minutes" 
						value={ fmt.Sprintf("%d", settings.S3BackupDelayMinutes) }
						class="input input-bordered w-full" 
						placeholder="0"
						min="0"
						max="43200"
						required
					/>
					<label class="label">
						<span class="label-text-alt">Nach wie vielen Minuten nach dem Upload soll das S3 Backup erfolgen? 0 = sofort, 1440 = nach 24 Stunden</span>
					</label>
				</div>

				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">S3 Backup Check Intervall (Minuten)</span>
					</label>
					<input 
						type="number" 
						name="s3_backup_check_interval" 
						value={ fmt.Sprintf("%d", settings.S3BackupCheckInterval) }
						class="input input-bordered w-full" 
						placeholder="5"
						min="1"
						max="60"
						required
					/>
					<label class="label">
						<span class="label-text-alt">Wie oft soll nach ausstehenden S3 Backups gesucht werden? (1-60 Minuten)</span>
					</label>
				</div>

				<div class="form-control">
					<label class="label">
						<span class="label-text font-semibold">S3 Retry Intervall (Minuten)</span>
					</label>
					<input 
						type="number" 
						name="s3_retry_interval" 
						value={ fmt.Sprintf("%d", settings.S3RetryInterval) }
						class="input input-bordered w-full" 
						placeholder="2"
						min="1"
						max="60"
						required
					/>
					<label class="label">
						<span class="label-text-alt">Wartezeit zwischen Wiederholungsversuchen für fehlgeschlagene S3 Backups (1-60 Minuten)</span>
					</label>
				</div>

				<!-- Thumbnail Format Settings -->
				<div class="divider">Thumbnail-Format Einstellungen</div>
				
				<div class="form-control">
					<label class="label cursor-pointer">
						<span class="label-text font-semibold">Original-Format Thumbnails</span>
						<input 
							type="checkbox" 
							name="thumbnail_original_enabled" 
							class="checkbox"
							if settings.ThumbnailOriginalEnabled {
								checked
							}
						/>
					</label>
					<label class="label">
						<span class="label-text-alt">Generiert Thumbnails im ursprünglichen Dateiformat (JPG, PNG, etc.).</span>
					</label>
				</div>

				<div class="form-control">
					<label class="label cursor-pointer">
						<span class="label-text font-semibold">WebP-Format Thumbnails</span>
						<input 
							type="checkbox" 
							name="thumbnail_webp_enabled" 
							class="checkbox"
							if settings.ThumbnailWebPEnabled {
								checked
							}
						/>
					</label>
					<label class="label">
						<span class="label-text-alt">Generiert optimierte Thumbnails im WebP-Format für bessere Kompression.</span>
					</label>
				</div>

				<div class="form-control">
					<label class="label cursor-pointer">
						<span class="label-text font-semibold">AVIF-Format Thumbnails</span>
						<input 
							type="checkbox" 
							name="thumbnail_avif_enabled" 
							class="checkbox"
							if settings.ThumbnailAVIFEnabled {
								checked
							}
						/>
					</label>
					<label class="label">
						<span class="label-text-alt">Generiert hochoptimierte Thumbnails im AVIF-Format (erfordert FFmpeg).</span>
					</label>
				</div>

				<!-- Actions -->
				<div class="flex justify-end space-x-4 pt-6">
					<a href="/admin" class="btn btn-ghost">Abbrechen</a>
					<button type="submit" class="btn btn-primary">Einstellungen speichern</button>
				</div>
			</form>
		</div>
	</div>
}

templ Settings(settings models.AppSettings, csrfToken string) {
	@AdminLayout(settingsContent(settings, csrfToken))
}
